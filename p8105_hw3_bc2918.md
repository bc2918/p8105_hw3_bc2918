Homework 3
================
Beibei Cao
2020-10-07

### Problem 1

``` r
data("instacart")
```

This dataset contains 1384617 rows and … columns.

Observations are the level of items in orders by user. There are user /
order variables – user ID, order ID, order day, and order hour. There
are also item variables – name, aisle, department, and some numeric
codes.

How many aisles, and which are most items from?

``` r
instacart %>% 
    count(aisle) %>% 
    arrange(desc(n))
```

    ## # A tibble: 134 x 2
    ##    aisle                              n
    ##    <chr>                          <int>
    ##  1 fresh vegetables              150609
    ##  2 fresh fruits                  150473
    ##  3 packaged vegetables fruits     78493
    ##  4 yogurt                         55240
    ##  5 packaged cheese                41699
    ##  6 water seltzer sparkling water  36617
    ##  7 milk                           32644
    ##  8 chips pretzels                 31269
    ##  9 soy lactosefree                26240
    ## 10 bread                          23635
    ## # … with 124 more rows

Let’s make a plot

``` r
instacart %>% 
    count(aisle) %>% 
    filter(n > 10000) %>% 
    mutate(
        aisle = factor(aisle),
        aisle = fct_reorder(aisle, n)
    ) %>% 
    ggplot(aes(x = aisle, y = n)) + 
    geom_point() + 
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```

<img src="p8105_hw3_bc2918_files/figure-gfm/unnamed-chunk-3-1.png" width="90%" />

Let’s make a table\!\!

``` r
instacart %>% 
    filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>% 
    group_by(aisle) %>% 
    count(product_name) %>% 
    mutate(rank = min_rank(desc(n))) %>% 
    filter(rank < 4) %>% 
    arrange(aisle, rank) %>% 
    knitr::kable()
```

| aisle                      | product\_name                                 |    n | rank |
| :------------------------- | :-------------------------------------------- | ---: | ---: |
| baking ingredients         | Light Brown Sugar                             |  499 |    1 |
| baking ingredients         | Pure Baking Soda                              |  387 |    2 |
| baking ingredients         | Cane Sugar                                    |  336 |    3 |
| dog food care              | Snack Sticks Chicken & Rice Recipe Dog Treats |   30 |    1 |
| dog food care              | Organix Chicken & Brown Rice Recipe           |   28 |    2 |
| dog food care              | Small Dog Biscuits                            |   26 |    3 |
| packaged vegetables fruits | Organic Baby Spinach                          | 9784 |    1 |
| packaged vegetables fruits | Organic Raspberries                           | 5546 |    2 |
| packaged vegetables fruits | Organic Blueberries                           | 4966 |    3 |

Apples vs ice cream..

``` r
instacart %>% 
    filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>% 
    group_by(product_name, order_dow) %>% 
    summarize(mean_hour = mean(order_hour_of_day)) %>% 
    pivot_wider(
        names_from = order_dow,
        values_from = mean_hour
    )
```

    ## `summarise()` regrouping output by 'product_name' (override with `.groups` argument)

    ## # A tibble: 2 x 8
    ## # Groups:   product_name [2]
    ##   product_name       `0`   `1`   `2`   `3`   `4`   `5`   `6`
    ##   <chr>            <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
    ## 1 Coffee Ice Cream  13.8  14.3  15.4  15.3  15.2  12.3  13.8
    ## 2 Pink Lady Apples  13.4  11.4  11.7  14.2  11.6  12.8  11.9

## Problem 2

This problem uses five weeks of accelerometer data collected on a 63
year-old male with BMI 25, who was admitted to the Advanced Cardiac Care
Center of Columbia University Medical Center and diagnosed with
congestive heart failure (CHF).

Load, tidy, and otherwise wrangle the accelerometer data.

``` r
# load the accel csv, transform the df from wide to long format
accel_df = 
  read_csv("./data/accel_data.csv") %>% 
  janitor::clean_names() %>% 
  pivot_longer(
   cols = starts_with("activity_"),
    names_to = "minute",
    names_prefix = "activity_",
    values_to = "activity_count"
  ) %>% 
  # encode data with reasonable variable classes, make the weekday ordered, add the weekend column
  mutate(
    week = as.integer(week),
    day_id = as.integer(day_id),
    day = as.factor(day),
    day = ordered(day, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday")),
    minute = as.integer(minute),
    weekend = if_else(day %in% c("Saturday", "Sunday"), TRUE, FALSE)
  ) %>% 
  # sort by week, day and minute
  arrange(week, day, minute)
```

``` r
# preview the df
accel_df
```

    ## # A tibble: 50,400 x 6
    ##     week day_id day    minute activity_count weekend
    ##    <int>  <int> <ord>   <int>          <dbl> <lgl>  
    ##  1     1      2 Monday      1              1 FALSE  
    ##  2     1      2 Monday      2              1 FALSE  
    ##  3     1      2 Monday      3              1 FALSE  
    ##  4     1      2 Monday      4              1 FALSE  
    ##  5     1      2 Monday      5              1 FALSE  
    ##  6     1      2 Monday      6              1 FALSE  
    ##  7     1      2 Monday      7              1 FALSE  
    ##  8     1      2 Monday      8              1 FALSE  
    ##  9     1      2 Monday      9              1 FALSE  
    ## 10     1      2 Monday     10              1 FALSE  
    ## # … with 50,390 more rows

The `accel_df` contains `50400` observations of `6` variables related to
accelerometer data collected on the male. The `week` is an integer
variable indicating the nth week of the observation (`1 - 5`); the
`day_id` is an integer variable indicating a unique id of the specific
day from `1` to `35`; the `day` is an ordered factor variable indicate
the day of the week; the `activity_count` is a double numeric variable
represents the activity counts in each minute ranging from `1` to 8982;
the `weekend` is a logical variable indicating whether the day is a
weekend or not.
